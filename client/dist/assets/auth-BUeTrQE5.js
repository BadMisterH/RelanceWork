import"./modulepreload-polyfill-B5Qt9EMX.js";import{s as u}from"./supabase-BUtq60nk.js";function R(){const e=void 0;if(e)return e;const t=window.location.origin;if(!/localhost|127\.0\.0\.1/.test(t))return`${t}/`;const o="http://localhost:3000/api";if(/^https?:\/\//.test(o)&&!/localhost|127\.0\.0\.1/.test(o))try{return`${new URL(o).origin}/`}catch{}return`${t}/`}const O=R();document.querySelectorAll("[data-landing-link]").forEach(e=>{e.href=O});function S(){const e="http://localhost:3000/api";return e||"/api"}const C=document.getElementById("loginForm"),B=document.getElementById("signupForm"),$=document.getElementById("forgotPasswordForm"),M=document.getElementById("resetPasswordForm"),D=[C,B,$,M];function c(e){D.forEach(s=>s?.classList.remove("active")),document.getElementById(e)?.classList.add("active")}const Z=document.querySelectorAll(".toggle-form");Z.forEach(e=>{e.addEventListener("click",()=>{const t=e.getAttribute("data-target");c(t==="signup"?"signupForm":t==="forgot"?"forgotPasswordForm":t==="reset"?"resetPasswordForm":"loginForm")})});const j=document.querySelector(".forgot-link");j?.addEventListener("click",e=>{e.preventDefault(),c("forgotPasswordForm")});const X=document.querySelectorAll(".password-toggle");X.forEach(e=>{e.addEventListener("click",()=>{const t=e.getAttribute("data-target"),s=document.getElementById(t),o=e.querySelector(".eye-open"),r=e.querySelector(".eye-closed");s.type==="password"?(s.type="text",o.style.display="none",r.style.display="block"):(s.type="password",o.style.display="block",r.style.display="none")})});const b=document.getElementById("signupPassword"),f=document.getElementById("passwordStrength"),w=f?.querySelector(".strength-text");b?.addEventListener("input",()=>{const e=b.value,t=V(e);f.className="password-strength",e.length===0?(f.classList.remove("weak","medium","strong"),w.textContent="Minimum 8 caractères"):t<40?(f.classList.add("weak"),w.textContent="Faible"):t<70?(f.classList.add("medium"),w.textContent="Moyen"):(f.classList.add("strong"),w.textContent="Fort")});function V(e){let t=0;return e.length>=8&&(t+=25),e.length>=12&&(t+=15),/[a-z]/.test(e)&&(t+=15),/[A-Z]/.test(e)&&(t+=15),/[0-9]/.test(e)&&(t+=15),/[^a-zA-Z0-9]/.test(e)&&(t+=15),t}function l(e,t){document.querySelector(".auth-notification")?.remove();const s={success:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" width="20" height="20"><polyline points="20 6 9 17 4 12"/></svg>',error:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" width="20" height="20"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>',info:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" width="20" height="20"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>'},o={success:"linear-gradient(135deg, #10b981, #059669)",error:"linear-gradient(135deg, #ef4444, #dc2626)",info:"linear-gradient(135deg, #2563eb, #1d4ed8)"},r=document.createElement("div");r.className="auth-notification",r.style.cssText=`
    position: fixed; top: 24px; right: 24px; z-index: 99999;
    display: flex; align-items: center; gap: 12px;
    padding: 14px 20px; border-radius: 12px;
    background: ${o[e]}; color: white;
    font-family: 'Inter', sans-serif; font-size: 14px; font-weight: 500;
    max-width: 420px; box-shadow: 0 8px 32px rgba(0,0,0,0.18);
    animation: authNotifIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    line-height: 1.4;
  `,r.innerHTML=`<span style="flex-shrink:0">${s[e]}</span><span>${t}</span>`;const i=document.createElement("style");i.textContent=`
    @keyframes authNotifIn { from { transform: translateX(120%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    @keyframes authNotifOut { from { transform: translateX(0); opacity: 1; } to { transform: translateX(120%); opacity: 0; } }
  `,document.head.appendChild(i),document.body.appendChild(r),setTimeout(()=>{r.style.animation="authNotifOut 0.3s ease forwards",setTimeout(()=>{r.remove(),i.remove()},300)},5e3)}const _=["temp-mail.org","tempmail.com","guerrillamail.com","mailinator.com","maildrop.cc","throwaway.email","getnada.com","trashmail.com","fakeinbox.com","sharklasers.com","guerrillamail.info","grr.la","guerrillamail.biz","guerrillamail.de","spam4.me","mailnesia.com","mytemp.email","temp-mail.io","mohmal.com","throwawaymail.com","yopmail.com","10minutemail.com","emailondeck.com","mintemail.com","dispostable.com","emailfake.com","inboxkitten.com","anonymousemail.me","crazymailing.com","mailcatch.com","mailtothis.com","tempinbox.com","incognitomail.com","fakemail.net","tmails.net","tempmail.net","getairmail.com","mailsac.com","burnermail.io","emailtemporanea.net","emailtemporanea.com","correotemporal.org"];function I(e){if(!/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(e))return!1;const s=e.toLowerCase().split("@")[1];return!_.includes(s)}function n(e,t){const s=document.getElementById(e),o=document.getElementById(e+"Error");s.classList.add("error"),s.classList.remove("success"),o.textContent=t}function d(e){const t=document.getElementById(e),s=document.getElementById(e+"Error");t.classList.add("success"),t.classList.remove("error"),s.textContent=""}function m(e){const t=document.getElementById(e),s=document.getElementById(e+"Error");t.classList.remove("error","success"),s.textContent=""}const W=document.getElementById("loginFormElement"),v=document.getElementById("loginBtn");W?.addEventListener("submit",async e=>{e.preventDefault();const t=document.getElementById("loginEmail").value,s=document.getElementById("loginPassword").value;m("loginEmail"),m("loginPassword");let o=!0;if(t?I(t)?d("loginEmail"):(n("loginEmail","Format d'email invalide"),o=!1):(n("loginEmail","L'email est requis"),o=!1),s?s.length<8?(n("loginPassword","Le mot de passe doit contenir au moins 8 caractères"),o=!1):d("loginPassword"):(n("loginPassword","Le mot de passe est requis"),o=!1),!!o){v.classList.add("loading"),v.disabled=!0;try{const{data:r,error:i}=await u.auth.signInWithPassword({email:t.toLowerCase(),password:s});if(i){if(console.error("Login error:",i),i.message.includes("Email not confirmed")){n("loginEmail","Veuillez vérifier votre email avant de vous connecter."),l("info","Un email de vérification vous a été envoyé lors de l'inscription. Vérifiez vos spams.");return}n("loginPassword","Email ou mot de passe incorrect");return}if(r.session){const a=r.user;if(!!!(a?.email_confirmed_at||a?.confirmed_at)){await u.auth.signOut(),n("loginEmail","Veuillez vérifier votre email avant de vous connecter."),l("error","Veuillez vérifier votre email avant de vous connecter.");return}window.location.href="/app"}}catch(r){console.error("Login error:",r),n("loginPassword","Erreur de connexion. Veuillez réessayer.")}finally{v.classList.remove("loading"),v.disabled=!1}}});const H=document.getElementById("signupFormElement"),E=document.getElementById("signupBtn");H?.addEventListener("submit",async e=>{e.preventDefault();const t=document.getElementById("signupName").value,s=document.getElementById("signupEmail").value,o=document.getElementById("signupPassword").value,r=document.getElementById("signupConfirmPassword").value,i=document.getElementById("acceptTerms").checked;m("signupName"),m("signupEmail"),m("signupPassword"),m("signupConfirmPassword");let a=!0;if(!t||t.trim().length<2?(n("signupName","Le nom doit contenir au moins 2 caractères"),a=!1):d("signupName"),!s)n("signupEmail","L'email est requis"),a=!1;else if(I(s))d("signupEmail");else{const g=s.toLowerCase().split("@")[1];_.includes(g)?n("signupEmail","Les emails temporaires ne sont pas autorisés. Utilisez un email permanent."):n("signupEmail","Format d'email invalide"),a=!1}if(o?o.length<8?(n("signupPassword","Le mot de passe doit contenir au moins 8 caractères"),a=!1):d("signupPassword"):(n("signupPassword","Le mot de passe est requis"),a=!1),r?o!==r?(n("signupConfirmPassword","Les mots de passe ne correspondent pas"),a=!1):d("signupConfirmPassword"):(n("signupConfirmPassword","Veuillez confirmer le mot de passe"),a=!1),i||(n("signupEmail","Veuillez accepter les conditions d'utilisation"),a=!1),!!a){E.classList.add("loading"),E.disabled=!0;try{const g=S(),k=await fetch(`${g}/auth/signup`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t,email:s,password:o})});if(!k.ok){const h=await k.json();console.error("Signup error:",h),n("signupEmail",h.message||"Erreur lors de l'inscription");return}const y=await k.json();if(y.emailVerificationRequired)C.classList.add("active"),B.classList.remove("active"),l("success","Compte créé ! Vérifiez votre email "+y.user.email+" pour activer votre compte.");else if(y.token){const{error:h}=await u.auth.setSession({access_token:y.token,refresh_token:y.token});h?(console.error("Session error:",h),C.classList.add("active"),B.classList.remove("active"),l("success","Compte créé ! Connectez-vous maintenant.")):window.location.href="/app"}else C.classList.add("active"),B.classList.remove("active"),l("success","Compte créé ! Connectez-vous maintenant.")}catch(g){console.error("Signup error:",g),n("signupEmail","Erreur d'inscription. Veuillez réessayer.")}finally{E.classList.remove("loading"),E.disabled=!1}}});const J=["loginEmail","signupEmail"];J.forEach(e=>{const t=document.getElementById(e);t?.addEventListener("blur",()=>{t.value&&!I(t.value)?n(e,"Format d'email invalide"):t.value&&d(e)})});const z=document.getElementById("signupConfirmPassword");z?.addEventListener("input",()=>{const e=document.getElementById("signupPassword").value,t=z.value;t&&e!==t?n("signupConfirmPassword","Les mots de passe ne correspondent pas"):t&&e===t?d("signupConfirmPassword"):m("signupConfirmPassword")});const F=document.getElementById("forgotPasswordFormElement"),L=document.getElementById("forgotBtn"),Y=document.getElementById("forgotSuccess");F?.addEventListener("submit",async e=>{e.preventDefault();const t=document.getElementById("forgotEmail").value;if(m("forgotEmail"),!t){n("forgotEmail","L'email est requis");return}if(!I(t)){n("forgotEmail","Format d'email invalide");return}L.classList.add("loading"),L.disabled=!0;try{const s=S(),o=await fetch(`${s}/auth/forgot-password`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t.toLowerCase()})});if(!o.ok){const r=await o.json();n("forgotEmail",r.message||"Erreur lors de l'envoi");return}F.style.display="none",Y.style.display="block"}catch(s){console.error("Reset password error:",s),n("forgotEmail","Erreur. Veuillez réessayer.")}finally{L.classList.remove("loading"),L.disabled=!1}});const G=document.getElementById("resetPasswordFormElement"),P=document.getElementById("resetBtn"),A=document.getElementById("resetPassword"),p=document.getElementById("resetPasswordStrength"),x=p?.querySelector(".strength-text");A?.addEventListener("input",()=>{const e=A.value,t=V(e);p.className="password-strength",e.length===0?(p.classList.remove("weak","medium","strong"),x.textContent="Minimum 8 caractères"):t<40?(p.classList.add("weak"),x.textContent="Faible"):t<70?(p.classList.add("medium"),x.textContent="Moyen"):(p.classList.add("strong"),x.textContent="Fort")});G?.addEventListener("submit",async e=>{e.preventDefault();const t=document.getElementById("resetPassword").value,s=document.getElementById("resetConfirmPassword").value;m("resetPassword"),m("resetConfirmPassword");let o=!0;if(t?t.length<8?(n("resetPassword","Le mot de passe doit contenir au moins 8 caractères"),o=!1):d("resetPassword"):(n("resetPassword","Le mot de passe est requis"),o=!1),s?t!==s?(n("resetConfirmPassword","Les mots de passe ne correspondent pas"),o=!1):d("resetConfirmPassword"):(n("resetConfirmPassword","Veuillez confirmer le mot de passe"),o=!1),!!o){P.classList.add("loading"),P.disabled=!0;try{const{error:r}=await u.auth.updateUser({password:t});if(r){console.error("Update password error:",r),n("resetPassword",r.message||"Erreur lors de la réinitialisation");return}const i=await u.auth.getSession();if(i.data.session?.access_token){const a=S();fetch(`${a}/auth/password-changed`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i.data.session.access_token}`}}).catch(()=>{})}l("success","Mot de passe mis à jour ! Vous pouvez vous connecter."),c("loginForm")}catch(r){console.error("Reset error:",r),n("resetPassword","Erreur. Veuillez réessayer.")}finally{P.classList.remove("loading"),P.disabled=!1}}});let T=!1;function U(){return new URLSearchParams(window.location.search)}function q(){const e=window.location.hash.startsWith("#")?window.location.hash.slice(1):window.location.hash;return new URLSearchParams(e)}function N(e="Choisissez votre nouveau mot de passe."){T=!0,c("resetPasswordForm"),l("info",e)}async function K(){const e=U(),t=q();if((e.get("type")||t.get("type"))!=="recovery")return!1;const o=t.get("access_token"),r=t.get("refresh_token")||"";try{if(o)await u.auth.setSession({access_token:o,refresh_token:r});else{const i=e.get("code")||t.get("code");i&&await u.auth.exchangeCodeForSession(i)}}catch(i){console.error("Recovery session error:",i)}return N(),!0}(async()=>{const e=U(),t=q(),s=e.get("error_code")||t.get("error_code"),o=e.get("error_description")||t.get("error_description");if(s){if(s==="otp_expired")l("error","Lien expiré. Veuillez demander un nouvel email de vérification.");else if(o){const a=o.replace(/\+/g," ");l("error",a)}else l("error","Lien invalide ou expiré. Veuillez réessayer.");c("loginForm"),history.replaceState(null,document.title,window.location.pathname+window.location.search);return}if(await K())return;const i=e.get("type")||t.get("type");(i==="signup"||i==="email_confirmation"||i==="magiclink")&&(l("success","Email vérifié ! Vous pouvez maintenant vous connecter."),c("loginForm")),u.auth.onAuthStateChange(a=>{a==="PASSWORD_RECOVERY"&&N()})})();
